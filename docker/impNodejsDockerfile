#docker files run as non-root user for better security
FROM node:25

WORKDIR /app

# Create non-root user
RUN groupadd -r appuser && useradd -r -g appuser appuser

COPY . .
RUN npm install

# Switch to non-root user
USER appuser

EXPOSE 3000
CMD ["npm", "start"]



#multi stage version
# -------- Build Stage --------
FROM node:25 AS builder

WORKDIR /build
COPY package.json ./
RUN npm install
COPY . .

# -------- Runtime Stage --------
FROM node:25-slim

WORKDIR /app
COPY --from=builder /build/app.js ./app.js
COPY --from=builder /build/node_modules ./node_modules

EXPOSE 3000
CMD ["node", "app.js"]


#multi stage with distroless
# -------- Build Stage --------
FROM node:25 AS buildr

WORKDIR /build
COPY package.json ./
RUN npm install
COPY . .

# -------- Runtime Stage --------
FROM gcr.io/distroless/nodejs20-debian12

WORKDIR /app
COPY --from=buildr /build/app.js ./app.js
COPY --from=buildr /build/node_modules ./node_modules

EXPOSE 3000
CMD ["app.js"]